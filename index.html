<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrackRide - GPS Tracking App</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-bg: #f8fafc;
            --dark-bg: #1e293b;
            --text-light: #334155;
            --text-dark: #f1f5f9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-light);
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--text-dark);
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
            overflow: hidden;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        body.dark-mode .header {
            background-color: #334155;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background-color: var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text-light);
        }

        body.dark-mode .theme-toggle {
            color: var(--text-dark);
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .map-container {
            flex: 1;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .sidebar {
            width: 350px;
            background-color: white;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        body.dark-mode .sidebar {
            background-color: #334155;
        }

        .sidebar.collapsed {
            transform: translateX(100%);
        }

        .sidebar-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            z-index: 1000;
        }

        body.dark-mode .sidebar-toggle {
            background-color: #334155;
            color: white;
        }

        .card {
            background-color: var(--light-bg);
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .card {
            background-color: #475569;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-icon {
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-arriving {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
        }

        .status-pickup {
            background-color: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
        }

        .driver-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .driver-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #64748b;
        }

        body.dark-mode .driver-avatar {
            background-color: #475569;
            color: #94a3b8;
        }

        .driver-details {
            flex: 1;
        }

        .driver-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .driver-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--warning-color);
            font-size: 0.9rem;
        }

        .trip-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #64748b;
        }

        body.dark-mode .detail-label {
            color: #94a3b8;
        }

        .detail-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
            flex: 1;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background-color: #e2e8f0;
            color: var(--text-light);
        }

        body.dark-mode .btn-secondary {
            background-color: #475569;
            color: var(--text-dark);
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .route-info {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .route-point {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .route-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .route-start {
            background-color: var(--success-color);
        }

        .route-end {
            background-color: var(--danger-color);
        }

        .route-details {
            flex: 1;
        }

        .route-address {
            font-weight: 500;
        }

        .route-note {
            font-size: 0.8rem;
            color: #64748b;
        }

        body.dark-mode .route-note {
            color: #94a3b8;
        }

        .map-controls {
            position: absolute;
            bottom: 1.5rem;
            left: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 1000;
        }

        .map-control {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background-color: white;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text-light);
        }

        body.dark-mode .map-control {
            background-color: #334155;
            color: var(--text-dark);
        }

        .location-marker {
            width: 20px;
            height: 20px;
            border-radius: 50% 50% 50% 0;
            background-color: var(--primary-color);
            transform: rotate(-45deg);
            position: relative;
        }

        .location-marker::after {
            content: '';
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: white;
            position: absolute;
            top: 4px;
            left: 4px;
        }

        .driver-marker {
            width: 24px;
            height: 24px;
            border-radius: 50% 50% 50% 0;
            background-color: var(--danger-color);
            transform: rotate(45deg);
            position: relative;
        }

        .driver-marker::after {
            content: '';
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: white;
            position: absolute;
            top: 5px;
            left: 5px;
        }

        .rider-marker {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--success-color);
            position: relative;
        }

        .rider-marker::after {
            content: '';
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: white;
            position: absolute;
            top: 4px;
            left: 4px;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                top: 0;
                right: 0;
                height: 100%;
                width: 85%;
                max-width: 320px;
                z-index: 1000;
                transform: translateX(100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-toggle {
                display: flex;
            }
        }

        @media (min-width: 769px) {
            .sidebar-toggle {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon">T</div>
                <span>TrackRide</span>
            </div>
            <button class="theme-toggle" id="themeToggle">üåô</button>
        </header>

        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
                <div class="map-controls">
                    <button class="map-control" id="locateMe" title="Locate Me">üìç</button>
                    <button class="map-control" id="findRide" title="Find My Ride">üöó</button>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>
            </div>

            <div class="sidebar" id="sidebar">
                <div class="card">
                    <h2 class="card-title">
                        <div class="card-icon">üöó</div>
                        Ride Information
                    </h2>
                    <div class="status-badge status-arriving">Driver Arriving - 5 min</div>
                    
                    <div class="driver-info">
                        <div class="driver-avatar">JD</div>
                        <div class="driver-details">
                            <div class="driver-name">John Driver</div>
                            <div class="driver-rating">
                                ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ <span>4.2</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="trip-details">
                        <div class="detail-item">
                            <div class="detail-label">Vehicle</div>
                            <div class="detail-value">Toyota Camry</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">License</div>
                            <div class="detail-value">ABC 123</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ETA</div>
                            <div class="detail-value" id="etaValue">5 min</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Distance</div>
                            <div class="detail-value" id="distanceValue">2.3 km</div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-secondary" id="callDriver">
                            <span>üìû</span> Call Driver
                        </button>
                        <button class="btn btn-primary" id="cancelRide">
                            <span>‚úï</span> Cancel Ride
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">
                        <div class="card-icon">üìç</div>
                        Route Details
                    </h2>
                    
                    <div class="route-info">
                        <div class="route-point">
                            <div class="route-icon route-start">A</div>
                            <div class="route-details">
                                <div class="route-address">123 Main Street</div>
                                <div class="route-note">Your current location</div>
                            </div>
                        </div>
                        
                        <div class="route-point">
                            <div class="route-icon route-end">B</div>
                            <div class="route-details">
                                <div class="route-address">456 Central Avenue</div>
                                <div class="route-note">Your destination</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">
                        <div class="card-icon">üí∞</div>
                        Fare Estimate
                    </h2>
                    <div class="detail-item">
                        <div class="detail-label">Estimated Fare</div>
                        <div class="detail-value">$15.50 - $20.00</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Payment Method</div>
                        <div class="detail-value">Credit Card ****1234</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App state
        const appState = {
            map: null,
            userLocation: null,
            driverLocation: null,
            riderLocation: null,
            routeLine: null,
            userMarker: null,
            driverMarker: null,
            riderMarker: null,
            isTracking: false,
            isDarkMode: false,
            driverInterval: null,
            eta: 5, // minutes
            distance: 2.3, // km
        };

        // DOM elements
        const mapElement = document.getElementById('map');
        const themeToggle = document.getElementById('themeToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const locateMeBtn = document.getElementById('locateMe');
        const findRideBtn = document.getElementById('findRide');
        const callDriverBtn = document.getElementById('callDriver');
        const cancelRideBtn = document.getElementById('cancelRide');
        const etaValue = document.getElementById('etaValue');
        const distanceValue = document.getElementById('distanceValue');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            initializeMap();
            setupEventListeners();
            simulateDriverMovement();
        });

        // Initialize the map
        function initializeMap() {
            // Default coordinates (San Francisco)
            const defaultCoords = [37.7749, -122.4194];
            
            // Create the map
            appState.map = L.map('map').setView(defaultCoords, 13);
            
            // Add light theme tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(appState.map);
            
            // Try to get user's current location
            locateUser();
            
            // Set initial driver and rider locations
            appState.driverLocation = [37.7849, -122.4294];
            appState.riderLocation = [37.7649, -122.4094];
            
            // Add markers
            addMarkers();
            
            // Draw initial route
            drawRoute();
        }

        // Set up event listeners
        function setupEventListeners() {
            themeToggle.addEventListener('click', toggleTheme);
            sidebarToggle.addEventListener('click', toggleSidebar);
            locateMeBtn.addEventListener('click', locateUser);
            findRideBtn.addEventListener('click', findMyRide);
            callDriverBtn.addEventListener('click', callDriver);
            cancelRideBtn.addEventListener('click', cancelRide);
        }

        // Toggle dark/light mode
        function toggleTheme() {
            appState.isDarkMode = !appState.isDarkMode;
            document.body.classList.toggle('dark-mode', appState.isDarkMode);
            
            // Update map theme
            if (appState.isDarkMode) {
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                    subdomains: 'abcd',
                    maxZoom: 20
                }).addTo(appState.map);
                themeToggle.textContent = '‚òÄÔ∏è';
            } else {
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(appState.map);
                themeToggle.textContent = 'üåô';
            }
            
            // Re-add markers and route
            addMarkers();
            drawRoute();
        }

        // Toggle sidebar visibility (mobile)
        function toggleSidebar() {
            sidebar.classList.toggle('open');
        }

        // Locate user using GPS
        function locateUser() {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by your browser');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    appState.userLocation = [latitude, longitude];
                    
                    // Update map view
                    appState.map.setView(appState.userLocation, 15);
                    
                    // Update user marker
                    updateUserMarker();
                },
                (error) => {
                    console.error('Error getting location:', error);
                    alert('Unable to retrieve your location. Using default location.');
                    
                    // Use default location as fallback
                    appState.userLocation = [37.7749, -122.4194];
                    appState.map.setView(appState.userLocation, 13);
                    updateUserMarker();
                }
            );
        }

        // Find my ride (simulate tracking)
        function findMyRide() {
            if (!appState.isTracking) {
                appState.isTracking = true;
                findRideBtn.textContent = 'üîÑ Tracking...';
                
                // In a real app, this would connect to a live tracking service
                alert('Tracking your ride... Driver location will update in real-time.');
                
                // Simulate driver movement
                if (appState.driverInterval) {
                    clearInterval(appState.driverInterval);
                }
                
                appState.driverInterval = setInterval(moveDriver, 3000);
            } else {
                appState.isTracking = false;
                findRideBtn.textContent = 'üöó Find My Ride';
                
                if (appState.driverInterval) {
                    clearInterval(appState.driverInterval);
                }
            }
        }

        // Call driver (simulated)
        function callDriver() {
            alert('Calling driver... This would connect to the driver in a real app.');
        }

        // Cancel ride (simulated)
        function cancelRide() {
            if (confirm('Are you sure you want to cancel this ride?')) {
                alert('Ride cancelled. In a real app, this would notify the driver and process any cancellation fees.');
                
                // Reset tracking
                appState.isTracking = false;
                findRideBtn.textContent = 'üöó Find My Ride';
                
                if (appState.driverInterval) {
                    clearInterval(appState.driverInterval);
                }
            }
        }

        // Add markers to the map
        function addMarkers() {
            // Clear existing markers
            if (appState.userMarker) appState.map.removeLayer(appState.userMarker);
            if (appState.driverMarker) appState.map.removeLayer(appState.driverMarker);
            if (appState.riderMarker) appState.map.removeLayer(appState.riderMarker);
            
            // Add user marker (if location available)
            if (appState.userLocation) {
                appState.userMarker = L.marker(appState.userLocation, {
                    icon: L.divIcon({
                        className: 'user-marker',
                        html: '<div class="location-marker"></div>',
                        iconSize: [20, 20],
                        iconAnchor: [10, 20]
                    })
                }).addTo(appState.map)
                .bindPopup('Your Location');
            }
            
            // Add driver marker
            appState.driverMarker = L.marker(appState.driverLocation, {
                icon: L.divIcon({
                    className: 'driver-marker',
                    html: '<div class="driver-marker"></div>',
                    iconSize: [24, 24],
                    iconAnchor: [12, 24]
                })
            }).addTo(appState.map)
            .bindPopup('Driver - John Driver');
            
            // Add rider marker (destination)
            appState.riderMarker = L.marker(appState.riderLocation, {
                icon: L.divIcon({
                    className: 'rider-marker',
                    html: '<div class="rider-marker"></div>',
                    iconSize: [20, 20],
                    iconAnchor: [10, 20]
                })
            }).addTo(appState.map)
            .bindPopup('Destination');
        }

        // Update user marker position
        function updateUserMarker() {
            if (appState.userMarker && appState.userLocation) {
                appState.userMarker.setLatLng(appState.userLocation);
            }
        }

        // Draw route between driver and rider
        function drawRoute() {
            // Remove existing route
            if (appState.routeLine) {
                appState.map.removeLayer(appState.routeLine);
            }
            
            // Create a simple curved route for demonstration
            const routeCoordinates = [
                appState.driverLocation,
                [
                    (appState.driverLocation[0] + appState.riderLocation[0]) / 2 + 0.005,
                    (appState.driverLocation[1] + appState.riderLocation[1]) / 2 + 0.005
                ],
                appState.riderLocation
            ];
            
            // Draw the route
            appState.routeLine = L.polyline(routeCoordinates, {
                color: appState.isDarkMode ? '#3b82f6' : '#1e40af',
                weight: 5,
                opacity: 0.7,
                lineJoin: 'round'
            }).addTo(appState.map);
        }

        // Simulate driver movement toward rider
        function moveDriver() {
            if (!appState.driverLocation || !appState.riderLocation) return;
            
            // Calculate direction vector
            const latDiff = appState.riderLocation[0] - appState.driverLocation[0];
            const lngDiff = appState.riderLocation[1] - appState.driverLocation[1];
            
            // Move driver a small step toward rider
            const stepSize = 0.0005;
            const latStep = latDiff * stepSize;
            const lngStep = lngDiff * stepSize;
            
            appState.driverLocation[0] += latStep;
            appState.driverLocation[1] += lngStep;
            
            // Update driver marker position
            appState.driverMarker.setLatLng(appState.driverLocation);
            
            // Update route
            drawRoute();
            
            // Update ETA and distance
            updateTripInfo();
            
            // Check if driver has arrived
            const distanceToRider = Math.sqrt(latDiff * latDiff + lngDiff * lngDiff);
            if (distanceToRider < 0.001) {
                clearInterval(appState.driverInterval);
                alert('Driver has arrived!');
                appState.isTracking = false;
                findRideBtn.textContent = 'üöó Find My Ride';
            }
        }

        // Update ETA and distance information
        function updateTripInfo() {
            // Simulate decreasing ETA and distance
            if (appState.eta > 0.5) {
                appState.eta -= 0.2;
                appState.distance -= 0.1;
                
                etaValue.textContent = `${appState.eta.toFixed(1)} min`;
                distanceValue.textContent = `${appState.distance.toFixed(1)} km`;
            }
        }

        // Initialize driver movement simulation
        function simulateDriverMovement() {
            // Start with a small movement to show the feature
            setTimeout(() => {
                moveDriver();
            }, 2000);
        }
    </script>
</body>
</html>
